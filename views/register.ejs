<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"
    />
    <meta
      name="Content-Security-Policy-Report-Only"
      content="script-src https://accounts.google.com/gsi/client; frame-src https://accounts.google.com/gsi/; connect-src https://accounts.google.com/gsi/;"
    />
    <meta
      name="google-signin-client_id"
      content="649922066604-90k8n6au857isf9oo7og9nhp9f0nhb8a.apps.googleusercontent.com"
    />

    <title>Meehh - Signup</title>

    <!-- Fav Icon -->
    <link rel="icon" href="assets/images/favicon.ico" type="image/x-icon" />

    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Josefin+Sans:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,400;0,500;0,600;0,700;0,800;0,900;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
      rel="stylesheet"
    />

    <!-- Stylesheets -->
    <link href="assets/css/font-awesome-all.css" rel="stylesheet" />
    <link href="assets/css/flaticon.css" rel="stylesheet" />
    <link href="assets/css/owl.css" rel="stylesheet" />
    <link href="assets/css/bootstrap.css" rel="stylesheet" />
    <link href="assets/css/jquery.fancybox.min.css" rel="stylesheet" />
    <link href="assets/css/animate.css" rel="stylesheet" />
    <link href="assets/css/jquery-ui.css" rel="stylesheet" />
    <link href="assets/css/jquery.bootstrap-touchspin.css" rel="stylesheet" />
    <link href="assets/css/nice-select.css" rel="stylesheet" />
    <link href="assets/css/color.css" rel="stylesheet" />
    <link href="assets/css/style.css" rel="stylesheet" />
    <link href="assets/css/responsive.css" rel="stylesheet" />

    <script src="https://accounts.google.com/gsi/client" async defer></script>
  </head>

  <!-- page wrapper -->
  <body>
   <div class="boxed_wrapper">
          <!-- search-popup -->
          <div id="search-popup" class="search-popup">
              <div class="close-search"><i class="flaticon-close"></i></div>
              <div class="popup-inner">
                  <div class="overlay-layer"></div>
                  <div class="search-form">
                      <form method="GET" action="/products/search">
                          <div class="form-group">
                              <fieldset>
                                  <input type="search" class="form-control" name="q" value="" placeholder="Search Here" required >
                                  <input type="submit" value="Search Now!" class="theme-btn style-four">
                              </fieldset>
                          </div>
                      </form>
                      <h3>Popular Search Keywords</h3>
                      <ul class="recent-searches">
                          <li><a href="/products?category=bookmark">Bookmark</a></li>
                          <li><a href="/products?category=pop gripper">Pop Grippers</a></li>
                          <li><a href="/products/search?q=friends">Friends</a></li>
                          <li><a href="/products/search?q">Game of Thrones</a></li>
                          <li><a href="/products/search?q=blackpink">Blackpink</a></li>
                      </ul>
                  </div>
              </div>
          </div>
          <!-- search-popup end -->


          <!-- main header -->
          <header class="main-header">
              
              <div class="header-lower">
                  <div class="auto-container">
                      <div class="outer-box">
                          <figure class="logo-box"><a href="/"><img src="assets/images/header-logo.png" alt=""></a></figure>
                          <div class="menu-area">
                              <!--Mobile Navigation Toggler-->
                              <div class="mobile-nav-toggler">
                                  <i class="icon-bar"></i>
                                  <i class="icon-bar"></i>
                                  <i class="icon-bar"></i>
                              </div>
                              <nav class="main-menu navbar-expand-md navbar-light">
                                  <div class="collapse navbar-collapse show clearfix" id="navbarSupportedContent">
                                      <ul class="navigation clearfix">
                                          <li class="current">
                                            <a href="/">Home</a>
                                          </li>
                                          <li class="dropdown"><a href="/products">Shop<span>Hot</span></a>
                                              <ul>
                                              <li><a href="/products?category=bookmark">Bookmarks</a></li>
                                              <li><a href="/products?category=pop gripper">Pop Grippers</a></li>
                                              <li><a href="/products?category=tote bag">Tote Bags</a></li>
                                              <li><a href="/products?category=badge">Badges</a></li>
                                              <li><a href="/products?category=a5 dairy">Diaries</a></li>
                                              <li><a href="/products?category=mousepad">Mousepads</a></li>
                                            </ul>
                                          </li>
                                          <li><a href="/about">About</a></li>    
                                          <!-- <li><a href="/blogs">Blog</a></li>  -->
                                          <li><a href="/contact">Contact</a></li>               
                                      </ul>
                                  </div>
                              </nav>
                          </div>
                          <ul class="menu-right-content clearfix">
                              <li>
                                  <div class="search-btn">
                                      <button type="button" class="search-toggler"><i class="flaticon-search"></i></button>
                                  </div>
                              </li>
                              <li><a href="/wishlist"><i class="flaticon-like"></i></a></li>
                              <li class="dropdown"><a href=""><i class="flaticon-user"></i></a>
                                <ul>
                                  <% if(userLoggedIn) { %>
                                  <li><a href="/profile">Profile</a></li>
                                  <li><a href="/orders">Your orders</a></li>
                                  <li><a href="/logout">Logout</a></li>
                                  <% } else { %> 
                                  <li><a href="/login">Log In</a></li>
                                  <li><a href="/register">Sign Up</a></li>
                                  <% } %>
                              </ul></li>
                              <li class="shop-cart">
                                  <a href="/cart"><i class="flaticon-shopping-cart-1"></i><span><%=cartLength%></span></a>
                              </li>
                          </ul>
                      </div>
                  </div>
              </div>

              <!--sticky Header-->
              <div class="sticky-header">
                  <div class="auto-container">
                      <div class="outer-box clearfix">
                          <div class="logo-box pull-left">
                              <figure class="logo"><a href="/"><img src="assets/images/small-logo.png" alt=""></a></figure>
                          </div>
                          <div class="menu-area pull-right">
                              <nav class="main-menu clearfix">
                                  <!--Keep This Empty / Menu will come through Javascript-->
                              </nav>
                          </div>
                      </div>
                  </div>
              </div>
          </header>
          <!-- main-header end -->

          <!-- Mobile Menu  -->
          <div class="mobile-menu">
              <div class="menu-backdrop"></div>
              <div class="close-btn"><i class="fas fa-times"></i></div>
              <nav class="menu-box">
                  <div class="nav-logo"><a href="/"><img src="assets/images/small-logo.png" alt="" title=""></a></div>
                  <div class="menu-outer"><!--Here Menu Will Come Automatically Via Javascript / Same Menu as in Header--></div>
                  <div class="contact-info">
                      <h4>Contact Info</h4>
                      <ul>
                          <!-- <li>Chicago 12, Melborne City, USA</li> -->
                          <li><a href="tel:+91-9773034478">+91 97730 34478</a></li>
                          <li><a href="mailto:meehh.com@gmail.com">meehh.com@gmail.com</a></li>
                      </ul>
                  </div>
                  <div class="social-links">
                      <ul class="clearfix">
                          <li><a href="/"><span class="fab fa-twitter"></span></a></li>
                          <li><a href="/"><span class="fab fa-facebook-square"></span></a></li>
                          <li><a href="/"><span class="fab fa-pinterest-p"></span></a></li>
                          <li><a href="/"><span class="fab fa-instagram"></span></a></li>
                          <li><a href="/"><span class="fab fa-youtube"></span></a></li>
                      </ul>
                  </div>
              </nav>
          </div><!-- End Mobile Menu -->
          
   

    <!-- myaccount-section -->
    <section class="myaccount-section">
      <div class="auto-container">
        <div class="row clearfix justify-content-center">
          <div class="col-lg-12 col-md-12 col-sm-12 inner-column">
            <div class="inner-box signup-inner p-3 py-4 p-sm-4 p-lg-5">
              <div class="upper-inner">
                <h3>Create An Account</h3>
                <p>Log in to access all your resources</p>
              </div>
              <div class="signup-alert"></div>
              <form class="default-form row g-6 signup-form">
                <div class="form-group col-md-6">
                  <label>First name</label>
                  <input type="text" name="first_name" required />

                  <span class="text-danger fname-message"> </span>
                </div>
                <div class="form-group col-md-6">
                  <label>Last name</label>
                  <input type="text" name="last_name" required />

                  <span class="text-danger lname-message"> </span>
                </div>
                <div class="form-group col-md-6">
                  <label>Email address</label>
                  <input type="email" name="email" required />

                  <span class="text-danger email-message"> </span>
                </div>
                <div class="form-group col-md-6">
                  <label>Phone Number</label>
                  <input type="text" name="phone_no" required />

                  <span class="text-danger phone-message"> </span>
                </div>
                <div class="form-group col-md-6">
                  <label>Password</label>
                  <input type="password" name="password" required />

                  <span class="text-danger password-message"> </span>
                </div>
                <div class="form-group col-md-6">
                  <label>Confirm Password</label>
                  <input type="password" name="confirm_password" required />

                  <span class="text-danger confirm_password-message"> </span>
                </div>
                <div class="form-group col-md-12">
                  <div class="custom-controls-stacked">
                    <label class="custom-control material-checkbox">
                      <input type="checkbox" class="material-control-input" />
                      <span class="material-control-indicator"></span>
                      <span class="description"
                        >I agree to terms & Policy.</span
                      >
                    </label>
                  </div>
                </div>
                <div class="form-group col-12 col-sm-4 col-lg-3">
                  <button type="submit" class="theme-btn-two">
                    Sign Up<i class="flaticon-right-1"></i>
                  </button>
                </div>
              </form>
              <div class="lower-inner centred">
                <span>or</span>
                <ul class="social-links clearfix">
                  <li>
                    <div id="google-login-btn"></div>
                  </li>
                </ul>
                <p>
                  Already have an account?
                  <a href="/login" class="text-primary">Log In Now</a>
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!-- myaccount-section end -->

    <script>
      // send token recieved from google after user sign up to server to create user
      async function handleCredentialResponse(response) {
        const token = response.credential;

        const res = await fetch("/auth/google/sign-up", {
          method: "POST",
          body: JSON.stringify({ token: token }),
          headers: {
            "Content-Type": "application/json",
          },
        });
        if (res.ok) {
          location.assign("/products");
        } else {
          const data = await res.json();
          console.log(data);
        }
      }

      // inititalize google signup button
      window.onload = function () {
        google.accounts.id.initialize({
          client_id:
            "649922066604-90k8n6au857isf9oo7og9nhp9f0nhb8a.apps.googleusercontent.com",
          callback: handleCredentialResponse,
        });
        google.accounts.id.renderButton(
          document.getElementById("google-login-btn"),
          { theme: "filled_blue", size: "large", text: "signup_with" } // customization attributes
        );
        google.accounts.id.prompt(); // also display the One Tap dialog
      };

      // handle user registration
      const form = document.querySelector("form.signup-form");
      const alert = document.querySelector("div.signup-alert");
      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        // get the input values
        const first_name = form.first_name.value;
        const last_name = form.last_name.value;
        const email = form.email.value;
        const phone_no = form.phone_no.value;
        const password = form.password.value;
        const confirm_password = form.confirm_password.value;

        console.log(
          first_name,
          last_name,
          phone_no,
          password,
          confirm_password,
          email
        );

        const body = {
          first_name,
          last_name,
          phone_no,
          email,
          password,
          confirm_password,
        };

        try {
          console.log(body);
          const res = await fetch("/register", {
            method: "POST",
            body: JSON.stringify(body),
            headers: {
              "Content-Type": "application/json",
            },
          });
          const data = await res.json();
          console.log(data);
          if (res.ok) {
            alert.textContent = "User registration successful!";
            alert.classList.remove("hide");
            alert.classList.add("alert");
            alert.classList.add("alert-success");
            setTimeout(() => location.assign("/products"), 1000);
          } else {
            document.querySelector("span.fname-message").textContent =
              data.errors.first_name;
            document.querySelector("span.lname-message").textContent =
              data.errors.last_name;
            document.querySelector("span.email-message").textContent =
              data.errors.email;
            document.querySelector("span.phone-message").textContent =
              data.errors.phone_no;
            document.querySelector("span.password-message").textContent =
              data.errors.password;
            document.querySelector(
              "span.confirm_password-message"
            ).textContent = data.errors.confirm_password;
          }
        } catch (err) {
          console.log(err);
        }
      });
    </script>

    <!-- jequery plugins -->
    <script src="assets/js/jquery.js"></script>
    <script src="assets/js/popper.min.js"></script>
    <script src="assets/js/bootstrap.min.js"></script>
    <script src="assets/js/owl.js"></script>
    <script src="assets/js/wow.js"></script>
    <script src="assets/js/validation.js"></script>
    <script src="assets/js/jquery.fancybox.js"></script>
    <script src="assets/js/TweenMax.min.js"></script>
    <script src="assets/js/appear.js"></script>
    <script src="assets/js/scrollbar.js"></script>
    <script src="assets/js/jquery.nice-select.min.js"></script>
    <script src="assets/js/isotope.js"></script>
    <script src="assets/js/jquery-ui.js"></script>
    <script src="assets/js/jquery.bootstrap-touchspin.js"></script>

    <!-- main-js -->
    <script src="assets/js/script.js"></script>
  </body>
  <!-- End of .page_wrapper -->
</html>
