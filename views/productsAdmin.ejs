<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"
    />

    <title>Meehh.com - Products</title>

    <!-- Fav Icon -->
    <link rel="icon" href="/assets/images/favicon.ico" type="image/x-icon" />

    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Josefin+Sans:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,400;0,500;0,600;0,700;0,800;0,900;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
      rel="stylesheet"
    />

    <!-- Stylesheets -->
    <link href="/assets/css/font-awesome-all.css" rel="stylesheet" />
    <link href="/assets/css/flaticon.css" rel="stylesheet" />
    <link href="/assets/css/owl.css" rel="stylesheet" />
    <link href="/assets/css/bootstrap.css" rel="stylesheet" />
    <link href="/assets/css/jquery.fancybox.min.css" rel="stylesheet" />
    <link href="/assets/css/animate.css" rel="stylesheet" />
    <link href="/assets/css/jquery-ui.css" rel="stylesheet" />
    <link href="/assets/css/nice-select.css" rel="stylesheet" />
    <link href="/assets/css/color.css" rel="stylesheet" />
    <link href="/assets/css/style.css" rel="stylesheet" />
    <link href="/assets/css/responsive.css" rel="stylesheet" />
  </head>

  <!-- page wrapper -->
  <body>
    <div class="boxed_wrapper">
      <!-- search-popup -->
          <div id="search-popup" class="search-popup">
              <div class="close-search"><i class="flaticon-close"></i></div>
              <div class="popup-inner">
                  <div class="overlay-layer"></div>
                  <div class="search-form">
                      <form method="GET" action="/products/search">
                          <div class="form-group">
                              <fieldset>
                                  <input type="search" class="form-control" name="q" value="" placeholder="Search Here" required >
                                  <input type="submit" value="Search Now!" class="theme-btn style-four">
                              </fieldset>
                          </div>
                      </form>
                      <h3>Popular Search Keywords</h3>
                      <ul class="recent-searches">
                          <li><a href="/products?category=bookmark">Bookmark</a></li>
                          <li><a href="/products?category=pop gripper">Pop Grippers</a></li>
                          <li><a href="/products/search?q=friends">Friends</a></li>
                          <li><a href="/products/search?q">Game of Thrones</a></li>
                          <li><a href="/products/search?q=blackpink">Blackpink</a></li>
                      </ul>
                  </div>
              </div>
          </div>
          <!-- search-popup end -->


          <!-- main header -->
          <header class="main-header">
              
              <div class="header-lower">
                  <div class="auto-container">
                      <div class="outer-box">
                          <figure class="logo-box"><a href="/"><img src="assets/images/header-logo.png" alt=""></a></figure>
                          <div class="menu-area">
                              <!--Mobile Navigation Toggler-->
                              <div class="mobile-nav-toggler">
                                  <i class="icon-bar"></i>
                                  <i class="icon-bar"></i>
                                  <i class="icon-bar"></i>
                              </div>
                              <nav class="main-menu navbar-expand-md navbar-light">
                                  <div class="collapse navbar-collapse show clearfix" id="navbarSupportedContent">
                                      <ul class="navigation clearfix">
                                          <li class="current">
                                            <a href="/">Home</a>
                                          </li>
                                          <li class="dropdown"><a href="/products">Shop<span>Hot</span></a>
                                              <ul>
                                              <li><a href="/products?category=bookmark">Bookmarks</a></li>
                                              <li><a href="/products?category=pop gripper">Pop Grippers</a></li>
                                              <li><a href="/products?category=tote bag">Tote Bags</a></li>
                                              <li><a href="/products?category=badge">Badges</a></li>
                                              <li><a href="/products?category=a5 dairy">Diaries</a></li>
                                              <li><a href="/products?category=mousepad">Mousepads</a></li>
                                            </ul>
                                          </li>
                                          <li><a href="/about">About</a></li>    
                                          <!-- <li><a href="/blogs">Blog</a></li>  -->
                                          <li><a href="/contact">Contact</a></li>               
                                      </ul>
                                  </div>
                              </nav>
                          </div>
                          <ul class="menu-right-content clearfix">
                              <li>
                                  <div class="search-btn">
                                      <button type="button" class="search-toggler"><i class="flaticon-search"></i></button>
                                  </div>
                              </li>
                              <li><a href="/wishlist"><i class="flaticon-like"></i></a></li>
                              <li class="dropdown"><a href=""><i class="flaticon-user"></i></a>
                                <ul>
                                  <% if(userLoggedIn) { %>
                                  <li><a href="/profile">Profile</a></li>
                                  <li><a href="/orders">Your orders</a></li>
                                  <li><a href="/logout">Logout</a></li>
                                  <% } else { %> 
                                  <li><a href="/login">Log In</a></li>
                                  <li><a href="/register">Sign Up</a></li>
                                  <% } %>
                              </ul></li>
                              <li class="shop-cart">
                                  <a href="/cart"><i class="flaticon-shopping-cart-1"></i><span><%=cartLength%></span></a>
                              </li>
                          </ul>
                      </div>
                  </div>
              </div>

              <!--sticky Header-->
              <div class="sticky-header">
                  <div class="auto-container">
                      <div class="outer-box clearfix">
                          <div class="logo-box pull-left">
                              <figure class="logo"><a href="/"><img src="assets/images/small-logo.png" alt=""></a></figure>
                          </div>
                          <div class="menu-area pull-right">
                              <nav class="main-menu clearfix">
                                  <!--Keep This Empty / Menu will come through Javascript-->
                              </nav>
                          </div>
                      </div>
                  </div>
              </div>
          </header>
          <!-- main-header end -->

          <!-- Mobile Menu  -->
          <div class="mobile-menu">
              <div class="menu-backdrop"></div>
              <div class="close-btn"><i class="fas fa-times"></i></div>
              <nav class="menu-box">
                  <div class="nav-logo"><a href="/"><img src="assets/images/small-logo.png" alt="" title=""></a></div>
                  <div class="menu-outer"><!--Here Menu Will Come Automatically Via Javascript / Same Menu as in Header--></div>
                  <div class="contact-info">
                      <h4>Contact Info</h4>
                      <ul>
                          <!-- <li>Chicago 12, Melborne City, USA</li> -->
                          <li><a href="tel:+91-9773034478">+91 97730 34478</a></li>
                          <li><a href="mailto:meehh.com@gmail.com">meehh.com@gmail.com</a></li>
                      </ul>
                  </div>
                  <div class="social-links">
                      <ul class="clearfix">
                          <li><a href="/"><span class="fab fa-twitter"></span></a></li>
                          <li><a href="/"><span class="fab fa-facebook-square"></span></a></li>
                          <li><a href="/"><span class="fab fa-pinterest-p"></span></a></li>
                          <li><a href="/"><span class="fab fa-instagram"></span></a></li>
                          <li><a href="/"><span class="fab fa-youtube"></span></a></li>
                      </ul>
                  </div>
              </nav>
          </div><!-- End Mobile Menu -->

      <!-- page-title -->
      <section class="page-title centred">
        <div
          class="pattern-layer"
          style="background-image: url(assets/images/bannerIMG.png)"
        ></div>
        <div class="auto-container">
          <div class="content-box">
            <h1>Products</h1>
            <ul class="bread-crumb clearfix">
              <li><i class="flaticon-home-1"></i><a href="/">Home</a></li>
              <li>Products</li>
            </ul>
          </div>
        </div>
      </section>
      <!-- page-title end -->

      <!-- added to cart alert -->
      <div class="products-alert d-none">
        <div
          class="alert alert-success alert-dismissible fade show"
          role="alert"
        >
          <span class="text"></span>
          <button
            type="button"
            class="close"
            data-dismiss="alert"
            aria-label="Close"
          >
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
      </div>

      <!-- shop-page-section -->
      <section class="shop-page-section shop-page-1">
        <div class="auto-container">
          <div class="item-shorting clearfix">
            <div class="left-column pull-left clearfix">
              <!-- <div class="text mx-0"><p>Showing 1–12 of 50 Results</p></div> -->
            </div>
          </div>

          <div class="our-shop">
            <div class="row clearfix" id="productContainer">
              <% if(productList[0]!=null && productList[0]!=undefined) { %>
                <% for(let i=0;i<productList.length;i++) { %>
                <div class="col-lg-3 col-md-6 col-sm-12 shop-block">
                  <div class="shop-block-one">
                    <div class="inner-box">
                      <figure class="image-box">
                        <img
                          src="<%= productList[i].inventory[0].large_images[0]%>"
                          alt="<%= productList[i].product_name %>"
                        />
                        <ul class="info-list clearfix">
                          <li onClick="addWishlist('<%= productList[i]._id %>')">
                            <a><i class="flaticon-heart"></i></a>
                          </li>
                          <li onClick="addToCart('<%= productList[i]._id %>')">
                            <a>Add to cart</a>
                          </li>
                        </ul>
                      </figure>
                      <div class="lower-content">
                        <% if(isAdmin){%>
                          
                          <a target="_blank" href= "/admin/getProduct/<%= productList[i]._id %>">
                            <%= productList[i].product_name %>
                          </a>

                        <% }else{%>
                          
                          <a target="_blank" href= "/products/<%= productList[i]._id %>">
                            <%= productList[i].product_name %>
                          </a>

                        <%}%>
                        
                        <span class="price">&#8377; <%= productList[i].price %></span>
                      </div>
                    </div>
                  </div>
                </div>
                <% } %>
              <% } else { %>
                <% for(let i=0;i<Object.keys(productList).length;i++) { %> 
                  <% const category = Object.keys(productList)[i];%>
                  <h3 class="col-12 category-title"><%=category%></h3>
                  <br>
                  <% for(let j=0;j<productList[category].length;j++) { %>
                    <div class="col-lg-3 col-md-6 col-sm-12 shop-block">
                      <div class="shop-block-one">
                        <div class="inner-box">
                          <figure class="image-box">
                            <img
                              src="<%= productList[category][j].inventory[0].large_images[0] %>"
                              alt=""
                            />
                            <ul class="info-list clearfix">
                              <li onClick="addWishlist('<%= productList[category][j]._id %>')">
                                <a><i class="flaticon-heart"></i></a>
                              </li>
                              <li onClick="addToCart('<%= productList[category][j]._id %>')">
                                <a>Add to cart</a>
                              </li>
                            </ul>
                          </figure>
                          <div class="lower-content">
                            <a target="_blank" href="/editProducts/changeDetails/<%= productList[category][j]._id %>">
                              <%= productList[category][j].product_name %>
                            </a>
                            <span class="price">&#8377;<%= productList[category][j].price %></span>
                          </div>
                        </div>
                      </div>
                    </div>
                  <% } %>
                  <a href="/products?category=<%=category%>">
                    <button class="theme-btn-two see-all">
                      See All<i class="flaticon-right-1"></i>
                    </button>
                  </a>
                <% } %>
              <% } %>

            </div>
            <% if(productList[0]!=null && productList[0]!=undefined) { %>
              <button class="theme-btn-two" id="loadMore" onClick="loadMoreProducts()">
                  Load More
                </button>
            <% }%>
          </div>
        </div>
      </section>
      <!-- shop-page-section end -->

      <!-- main-footer -->
      <%- include('footer') %>
      <!-- main-footer end -->

      <!--Scroll to top-->
      <button class="scroll-top scroll-to-target" data-target="html">
        <i class="fas fa-long-arrow-alt-up"></i>
      </button>
    </div>

    <!-- jequery plugins -->
    <script src="assets/js/jquery.js"></script>
    <script src="assets/js/popper.min.js"></script>
    <script src="assets/js/bootstrap.min.js"></script>
    <script src="assets/js/owl.js"></script>
    <script src="assets/js/wow.js"></script>
    <script src="assets/js/validation.js"></script>
    <script src="assets/js/jquery.fancybox.js"></script>
    <script src="assets/js/TweenMax.min.js"></script>
    <script src="assets/js/appear.js"></script>
    <script src="assets/js/scrollbar.js"></script>
    <script src="assets/js/jquery.nice-select.min.js"></script>
    <script src="assets/js/isotope.js"></script>
    <script src="assets/js/jquery-ui.js"></script>

    <!-- main-js -->
    <script src="assets/js/script.js"></script>
    <script>
      const alert = document.querySelector(".alert > span.text");

      async function addWishlist(id) {
        console.log(id);
        const data = { id: id };
        const url = "/wishlist/addWishlist";
        const options = {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            // 'Content-Type': 'application/x-www-form-urlencoded',
          },
          body: JSON.stringify(data),
        };
        const res = await fetch(url, options);
        if (res.ok) {
          document.querySelector(".products-alert").classList.remove("d-none");
          alert.innerText = "Item added to the wishlist!";
          setTimeout(()=> {
            document.querySelector(".products-alert").classList.add("d-none");
            alert.innerText = ""
          }, 1000)
        } else console.log(res);
      }

      async function loadMoreProducts() {
        let categoryName=null;
        let search = null;

        if(window.location.search.length){
          if(window.location.search.substr(1).split("=")[0] == "category"){
            categoryName = window.location.search.substr(1).split('&')[0].split('=')[1].replace("%20"," ");
          }
          else if(window.location.search.substr(1).split("=")[0] == "q"){
            search = window.location.search.substr(1).split('&')[0].split('=')[1].replace("%20"," ");
          }
          console.log(categoryName,search);
        }

        const url = "/products";
        
        const reqData = {
          productsLoaded:document.getElementById("productContainer").children.length,
          category: categoryName,
          search:search
        };
        const options = {
          headers: {
            "Content-Type": "application/json",
          },
          method: "POST",
          body: JSON.stringify(reqData),
        };


        const response = await fetch(url, options);
        const data = await response.json();

        console.log(data.newProducts);

        if(data.newProducts.length == 0){
          const loadMore = document.getElementById("loadMore").style.display="none";
        }
        data.newProducts.map((product) => {
          const imgSource =
            product.inventory[0].thumbnail_images[0] ||product.inventory[0].large_images[0]
            "assets/images/resource/shop/shop-1.jpg";
          const productID = product._id;
          const productName = product.product_name;
          const productPrice = product.price;

          createProductElements(
            imgSource,
            productID,
            productName,
            productPrice
          );

        });
      }

      function createProductElements(
        imageSource,
        productID,
        productName,
        productPrice
      ) {
        //starting of first div
        const shopBlock = document.createElement("div");
        shopBlock.classList.add(
          "col-lg-3",
          "col-md-6",
          "col-sm-12",
          "shop-block"
        );

        shopBlock.innerHTML = `
                <div class="shop-block-one">
                  <div class="inner-box">
                    <figure class="image-box">
                      <img
                        src=${imageSource}
                        alt=${productName}
                        loading="lazy"
                      />
                      <ul class="info-list clearfix">
                        <li onClick="()=>addWishlist(${productID})">
                          <a><i class="flaticon-heart"></i></a>
                        </li>
                        <li onClick="addToCart(${productID})">
                          <a>Add to cart</a>
                        </li>
                      </ul>
                    </figure>
                    <div class="lower-content">
                      <a target="_blank" href="/editProducts/changeDetails/${productID}">
                        ${productName}
                      </a>
                      <span class="price">&#8377;${productPrice}</span>
                    </div>
                  </div>
                </div>
              `

        //starting of otterDiv1's child div
        //child
        // const outterDiv0 = document.createElement("div");
        // outterDiv0.classList.add("shop-block-one");

        // //starting of outterDiv0's child div
        // //child
        // const innerDiv = document.createElement("div");
        // innerDiv.classList.add("inner-box");

        // //starting of innerDiv's Child figure
        // //child
        // const figure = document.createElement("figure");
        // figure.classList.add("image-box");

        // //starting of figure's img tag
        // //child
        // const image = document.createElement("img");
        // image.src = imageSource;
        // //end of image

        // //starting of figure's ul tag
        // const ul = document.createElement("ul");
        // ul.classList.add("info-list", "clearfix");

        // //strating of ul's first li tag
        // const li0 = document.createElement("li");
        // li0.onclick = ()=>addWishlist(productID);

        // //starting of li0's a tag
        // //child
        // const aTag0 = document.createElement("a");

        // //starting of aTag0's i tag
        // //child
        // const iTag0 = document.createElement("i");
        // iTag0.classList.add("flaticon-heart");
        // //end of iTag0
        // //end of aTag0
        // //end of li0

        // //starting of ul's second li tag
        // const li1 = document.createElement("li");
        // li1.onclick = ()=>addToCart(productID);

        // //starting of li1's a tag
        // //child
        // const aTag1 = document.createElement("a");
        // aTag1.textContent = "Add To cart";
        // //end of a tag
        // //end of li1 tag

        // //starting of ul's third li tag
        // const li2 = document.createElement("li");

        // //starting of li2's a tag
        // const aTag2 = document.createElement("a");
        // aTag2.classList.add("lightbox-image");
        // aTag2.href = "/products/" + productID;

        // //starting of aTag2's i tag
        // //child
        // const iTag2 = document.createElement("i");
        // iTag2.classList.add("flaticon-search");
        // //end of iTag2
        // //end of aTag2
        // //end of li2
        // //end of ul
        // //end of figure tag

        // //starting of innerDiv's second child div tag
        // const lowerContent = document.createElement("div");
        // lowerContent.classList.add("lower-content");

        // //starting of lowerContent's first child a tag
        // const aTag3 = document.createElement("a");
        // aTag3.href = "/products/" + productID;
        // aTag3.textContent = productName;
        // //end of aTag3

        // //starting of lowerContent's second child span Tag
        // const span = document.createElement("span");
        // span.classList.add("price");
        // span.textContent = "$"+productPrice;
        // //end of span tag

        // //end of lowerContent
        // //end of innerDiv
        // //end of outterDiv0
        // //end of outterDiv1

        // aTag0.appendChild(iTag0);
        // li0.appendChild(aTag0);

        // li1.appendChild(aTag1);

        // aTag2.appendChild(iTag2);
        // // li2.appendChild(aTag2);

        // ul.appendChild(li0);
        // ul.appendChild(li1);
        // ul.appendChild(li2);

        // figure.appendChild(image);
        // figure.appendChild(ul);

        // lowerContent.appendChild(aTag3);
        // lowerContent.appendChild(span);

        // innerDiv.appendChild(figure);
        // innerDiv.appendChild(lowerContent);

        // outterDiv0.appendChild(innerDiv);
        // outterDiv1.appendChild(outterDiv0);

        document.getElementById("productContainer").appendChild(shopBlock);
      }

      async function addToCart(id) {
        console.log(id);
        const data = {
          id,
          quantity: 1,
        };
        const url = "/cart/addToCart";
        const options = {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            // 'Content-Type': 'application/x-www-form-urlencoded',
          },
          body: JSON.stringify(data),
        };
        const res = await fetch(url, options);
        if (res.ok) {
          document.querySelector(".products-alert").classList.remove("d-none");
          alert.innerText = "Item added to cart!";
          setTimeout(()=> {
            document.querySelector(".products-alert").classList.add("d-none");
            alert.innerText = ""
          }, 1000)
        } else console.log(res);
      }
    </script>
  </body>
  <!-- End of .page_wrapper -->
</html>
